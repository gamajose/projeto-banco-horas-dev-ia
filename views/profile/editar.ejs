<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <% if (success_msg && success_msg.length> 0) { %>
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-6" role="alert">
            <strong class="font-bold">Sucesso!</strong>
            <span class="block sm:inline">
                <%= success_msg %>
            </span>
        </div>
        <% } %>
            <% if (error_msg && error_msg.length> 0) { %>
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6" role="alert">
                    <strong class="font-bold">Erro!</strong>
                    <span class="block sm:inline">
                        <%= error_msg %>
                    </span>
                </div>
                <% } %>

                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Editar Perfil</h1>

                    <form action="/profile/foto" method="POST" enctype="multipart/form-data" id="form-foto"
                        class="mb-8">
                        <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                            <h2 class="text-xl font-semibold text-gray-700 mb-4">Foto do Perfil</h2>
                            <div class="flex items-center space-x-6">
                                <img class="h-24 w-24 rounded-full object-cover"
                                    src="<%= profile.foto_url || '/images/default-avatar.png' %>" alt="Foto do Perfil">
                                <div>
                                    <input type="file" name="foto" id="foto-input"
                                        class="text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG ou GIF. A foto será enviada
                                        automaticamente ao ser selecionada.</p>
                                </div>
                            </div>
                        </div>
                    </form>

                    <form action="/profile/editar" method="POST" class="space-y-8">

                        <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                            <h2 class="text-xl font-semibold text-gray-700 mb-4">Dados Pessoais</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label for="nome" class="form-label">Nome Completo</label><input type="text"
                                        name="nome" id="nome" class="form-input" value="<%= profile.nome %>" required>
                                </div>
                                <div><label for="email" class="form-label">Email</label><input type="email" name="email"
                                        id="email" class="form-input" value="<%= user.email %>" required></div>
                                <div><label for="data_nascimento" class="form-label">Data de Nascimento</label><input
                                        type="date" name="data_nascimento" id="data_nascimento" class="form-input"
                                        value="<%= profile.data_nascimento ? new Date(profile.data_nascimento).toISOString().split('T')[0] : '' %>">
                                </div>
                                <div><label for="sexo" class="form-label">Sexo</label><select name="sexo" id="sexo"
                                        class="form-input">
                                        <option value="">Prefiro não informar</option>
                                        <option value="Masculino" <%=profile.sexo==='Masculino' ? 'selected' : '' %>
                                            >Masculino</option>
                                        <option value="Feminino" <%=profile.sexo==='Feminino' ? 'selected' : '' %>
                                            >Feminino</option>
                                    </select></div>
                                <div><label for="cpf" class="form-label">CPF (Opcional)</label><input type="text"
                                        name="cpf" id="cpf" class="form-input" placeholder="000.000.000-00"
                                        value="<%= profile.cpf || '' %>"></div>
                                <div><label for="telefone" class="form-label">Telefone Celular</label><input type="text"
                                        name="telefone" id="telefone" class="form-input" placeholder="(00) 00000-0000"
                                        value="<%= profile.telefone || '' %>"></div>
                                <div><label for="linkedin" class="form-label">LinkedIn (URL)</label><input type="url"
                                        name="linkedin" id="linkedin" class="form-input"
                                        placeholder="https://linkedin.com/in/seu-perfil"
                                        value="<%= profile.linkedin || '' %>"></div>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                            <h2 class="text-xl font-semibold text-gray-700 mb-4">Endereço</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="md:col-span-1"><label for="cep" class="form-label">CEP</label><input
                                        type="text" name="cep" id="cep" class="form-input"
                                        value="<%= profile.cep || '' %>"></div>
                                <div class="md:col-span-1"><label for="numero" class="form-label">Número</label><input
                                        type="text" name="numero" id="numero" class="form-input"
                                        value="<%= profile.numero || '' %>"></div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                                <div class="md:col-span-2"><label for="logradouro" class="form-label">Nome da
                                        Rua</label><input type="text" name="logradouro" id="logradouro"
                                        class="form-input" value="<%= profile.logradouro || '' %>"></div>
                                <div><label for="bairro" class="form-label">Bairro</label><input type="text"
                                        name="bairro" id="bairro" class="form-input"
                                        value="<%= profile.bairro || '' %>"></div>
                                <div><label for="cidade" class="form-label">Cidade</label><input type="text"
                                        name="cidade" id="cidade" class="form-input"
                                        value="<%= profile.cidade || '' %>"></div>
                                <div><label for="estado" class="form-label">Estado</label><input type="text"
                                        name="estado" id="estado" class="form-input" maxlength="2"
                                        value="<%= profile.estado || '' %>"></div>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
                            <h2 class="text-xl font-semibold text-gray-700 mb-4">Informações Organizacionais</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label class="form-label">Setor</label><input type="text"
                                        class="form-input bg-gray-100"
                                        value="<%= profile.setor_nome || 'Não definido' %>" disabled></div>
                                <div><label for="funcao" class="form-label">Função / Cargo</label><input type="text"
                                        name="funcao" id="funcao" class="form-input"
                                        value="<%= profile.funcao || '' %>"></div>
                            </div>
                        </div>

                        <div class="flex justify-end pt-4 space-x-3">
                            <a href="/" class="btn-secondary">Cancelar</a>
                            <button type="submit" class="btn-primary">Salvar Alterações</button>
                        </div>
                    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- LÓGICA DO UPLOAD AUTOMÁTICO DA FOTO ---
        const formFoto = document.getElementById('form-foto');
        const inputFoto = document.getElementById('foto-input');

        if (formFoto && inputFoto) {
            inputFoto.addEventListener('change', () => {
                // Submete o formulário da foto automaticamente quando um ficheiro é escolhido
                formFoto.submit();
            });
        }

        // --- LÓGICA DO PREENCHIMENTO DO CEP (Está correto!) ---
        const cepInput = document.getElementById('cep');
        const logradouroInput = document.getElementById('logradouro');
        const bairroInput = document.getElementById('bairro');
        const cidadeInput = document.getElementById('cidade');
        const estadoInput = document.getElementById('estado');

        // ... (o resto do seu código para o CEP continua aqui, sem alterações)
    });
</script>